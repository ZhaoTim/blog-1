在使用 React Hooks 的过程中，一直有很多疑问困扰着我。其中包括：



1. 为什么不能再 Class 组件中使用 Hooks？

2. 为什么不能在循环、条件语句或者嵌套函数中使用 Hooks？

3. Function 组件内部没有存储状态，那么状态保存在什么地方？

4. 同一个组件中多次调用 `useState`，如何保证每个 state 相互独立？

5. state 发生变化之后，为什么 `useEffect` 也会执行？

   

为了解答这些疑问，我去阅读了 React 中的相关源码。看了一会儿发现，毕竟是一个完善的开源框架，源码确实不太好读。回过头来，我不就是想了解 Hooks 的原理么，干嘛考虑那么多细枝末节的东西？不如自己实现一些核心的 Hooks，从中领悟精髓。



这篇文章参考 [preact](https://github.com/preactjs/preact) 的源码，通过简单的方式去实现 React 的核心 Hooks。虽然和 React 的实现不同，但核心思想是一样的。我们可以通过这种方式，更轻松地去理解 Hooks 的原理。



# useState



















- state  存储在什么地方？Function Component 中不会存储状态，那么状态放在什么地方？
- 在同一个 FC 中，如何保证每次调用 useState 得到的 state 的独立性？



为什么 class  组件能保存状态，而 Function 组件不能？因为函数运行会重置其内部作用域和变量。



> 直观来看，好像造成这种差异是因为在class里，我们能通过this保存和访问“状态(state)”，而函数组件在其作用域内难以维持“状态(state)”，因为再次函数运行会重置其作用域内部变量，这种差异导致了我们“不得不”使用class至今。

嵌套地域 -> 俄罗斯套娃
