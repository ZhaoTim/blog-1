#  拒绝 996 系列之自动化工具

从去年开始，大家就一直在讨论 996 这个话题。马云爸爸甚至说 996 是「修福报」。但是作为一个程序员，我是打心眼里看不起那些要 996 的人。996 反映了很多问题，一种是公司的问题，一种是自己的问题。本来要干半年的活，需要三个月干完。除了加班还有别的方式吗？还有一种是效率问题，一个 bug 可能别人几分钟就搞定了，而你却要花上好几个小时。



在华为工作时，加班到 9 点，改了一行代码的例子。

AI 智能的时代，机器写代码？在还没那么智能的时代，我们能想点别的方法减轻这方面的问题吗？



- 效率太低
  - 大量模板代码
  - 沟通成本

- 活太多
  - 三个月的活要一个月做完
  - 需求变化带来的改变
  - Bug 太多



我们要向 996 Say No! 作为一个前端开发，能不能从程序这里想点办法？



解决方案：

- 快速响应需求的变更
- 减少 Bug 的出现
- 出现 Bug 之后能够快速定位和修复
- 组件复用（50%的时间都是在写组件）



## 前后端分离带来的困扰

起因和痛点

前后端完全割裂开来，前后端各自成为一个黑盒。这样虽然职责分离，前后端可以并行开发，但是也带来了新的问题。需要通过一种方式，将前后端重新联系起来。



- 节省很大的前端工作量
- 解决前后端定义不一致的问题
- 解决前端重复定义 API Request / API Response 等模型的问题
- 替代契约测试的功能，当 API Schema 发生变化时，前端立刻得知结果，即 compile 失败。无需手动更新 API Schema，一个命令自动更新。
- 当 swagger 中有相同的 enum 定义时，只生成一个 enum，还是生成带前缀的不同的 enum？



## 通过自动化工具重新联结

在没有 codegen 之前是什么样的？

- 大量模板代码

- 可能重复定义 interface，造成混乱
- 比较难 debug









## 艰难的落地



如何推动？



被 TL 一盆冷水泼下来。

- 跟 package.json 一样，可以保证每个人生成出来的东西是一致的。这个东西不要本地修改，否则修改会被覆盖。对生成的方法进行排序，对 Git 友好。

- 多人协作的问题？如果都在改，可能会出现 conflict？出现 Conflict 的情况有哪些？
  - 后端增加了一个字段 - 不会出现问题
  - 后端删除了一个字段 - 可能会出现问题
  - 后端修改了一个字段的名字 - 可能会造成前端所有使用这个字段的地方都出现问题，无法通过编译。这个时候由谁来修改？如果那个人恰好工作在这张卡上，由他进行修改。后端重构导致以前的接口发生变化了，这时候所有人都没有工作在这个卡上，那么又由谁来修改的问题？（协作问题，这个问题其实以前也会有，现在反而更好的解决）。
  - 如果后端改了一个字段，不期望前端进行修改，那怎么办？这种情况已经导致前端功能出现问题了，难道不应该马上修复吗？卡的拆分的问题，后端先修改了，前端下个迭代才做这个卡的问题。

- 强依赖于后端的 API Schema，必须先定义好 Schema 才能开发前端。

- 在前后端进行开发之前，本来就要一起先把 API Schema 定义好。这样前端和后端一起定义，这样增强了沟通。

- 前后端进度不一致的问题，前端进度很快，后端进度很慢，导致后端无法先于前端实现好 API，甚至无法同时开始做一张卡。这时候面临的问题，就是你应该找谁一起定义 API Schema？后端都忙于自己的工作，无法抽出时间和你定义一些「超前进度」的 API Schema，这时候前端可以自己定义好 Schema，但是不实现任何内容。如果后端之后做卡时发现要修改 API Schema，配合自动生成工具和 TypeScript，前端也能更好的应对。

- 使用 Dev 环境还是 QA 环境来生成 API 的问题？Dev 代表这最新的 API（我们期望的结果，但是可能处于不稳定的状态），QA 环境（相对稳定，可是无法拿到最新的 API）。

  



如何让别人信任？



## 成果

使用起来也非常方便，如果业务场景比较简单，集成 API 就是一行代码的事：



```typescript
const [books] = useTempData(getBooksUsingGET, { bookType }, [bookType]);

// 拿到 books 数据，渲染 UI
```



`getBooksUsingGET` 方法是由自动化工具生成的。假设后端现在加了一个字段。。。



在项目中非常稳定。生成了上万行代码。算算这笔时间账。

反向支撑后端重构、后端说我们要重构、改个字段，API mock 数据自动更新就行，非常方便。

一个 API 可能要半个小时去写 interface、集成API、mock 数据、测试。成百上千的 API，为每个人节省了多少时间？

提升效率，既为公司节省了成本，又减轻了自己的工作负担，互利共赢。大家早早下班吃饭不好吗？



## 最后

如何提升自己和同事的效率，减少模板代码对于效率和精神的损耗。不加班的程序员才是好程序员。

遇到问题，可以自动化。做一个不用 996 的程序员。



